webpackJsonp([2],Array(54).concat([function(t,e,n){"use strict";var i=n(27),o=n(158),s=n(143),r=n.n(s);i.a.use(o.a),e.a=new o.a({routes:[{path:"/",name:"Editor",component:r.a}]})},,function(t,e,n){function i(t){n(102)}var o=n(3)(n(59),n(150),i,null,null);t.exports=o.exports},,function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(27),o=n(56),s=n.n(o),r=n(54),a=n(57),c=n(55),l=n.n(c);i.a.prototype.$http=l.a,i.a.use(a.a),i.a.config.productionTip=!1,new i.a({el:"#app",router:r.a,template:"<App/>",components:{App:s.a}})},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"app"}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(142),o=n.n(i),s=n(144),r=n.n(s),a=n(146),c=n.n(a);e.default={name:"Annotator",components:{AreaSelect:o.a,PDF:r.a,SelectionPreview:c.a},props:["src","name","selections","addSelection","arrayBuffer","setPdfSize"],data:function(){return{text:"",down:!1,coords:{xa:null,ya:null,xb:null,yb:null},pageNumber:1,pageOffset:{top:0,left:0}}},computed:{coordinates:function(){return{left:Math.min(this.coords.xa,this.coords.xb),top:Math.min(this.coords.ya,this.coords.yb),width:Math.abs(this.coords.xa-this.coords.xb),height:Math.abs(this.coords.ya-this.coords.yb),page:this.pageNumber,pageOffset:{top:this.pageOffset.top,left:this.pageOffset.left}}}},methods:{reset:function(){this.coords.xa=null,this.coords.ya=null,this.coords.xb=null,this.coords.yb=null},start:function(t){this.down=!0,this.pageNumber=parseInt(t.target.getAttribute("data-page-number")||1),this.pageOffset.top=t.target.offsetTop,this.pageOffset.left=t.target.offsetLeft,this.coords.xa=t.offsetX,this.coords.ya=t.offsetY,this.coords.xb=t.offsetX,this.coords.yb=t.offsetY},end:function(t){t.stopPropagation(),t.preventDefault(),this.down=!1,this.addSelection(this.coordinates),this.reset(),console.log(this.text)},drag:function(t){if(t.stopPropagation(),t.preventDefault(),this.down){this.coords.xb=t.offsetX,this.coords.yb=t.offsetY;var e=window.getSelection();this.text=e.toString()}}}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"area-select",props:["coordinates","color","name","active"],computed:{styleObject:function(){return 0===this.height||0===this.width?{display:"none"}:{left:this.coordinates.left+this.coordinates.pageOffset.left+"px",top:this.coordinates.top+this.coordinates.pageOffset.top+"px",width:this.coordinates.width+"px",height:this.coordinates.height+"px",border:"solid "+this.color+" 1px",background:this.color.replace(/\)$/,", 0.05)").replace("rgb(","rgba(")}}}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(147),o=n.n(i),s=n(141),r=n.n(s),a=n(148),c=n.n(a),l=n(145),d=n.n(l),f=n(126),u=n.n(f);e.default={name:"editor",components:{Uploader:o.a,Annotator:r.a,ZoneViewer:c.a,PDFZoneViewer:d.a},data:function(){return{pid:null,style:[],old_obs:[],req1_stat:!1,change:!1,file:null,obs:[],src:null,arrayBuffer:null,name:"",selections:[],pdfDimensions:{height:0,width:0}}},methods:{addfile:function(t){this.file=t},post:function(){this.change&&(this.req1_stat=!0,this.$http.post("http://127.0.0.1:5000/post_pdf",{pfile:this.file}).then(function(t){console.log(t),console.log([{pdf:this.file,name:this.name}]).catch(function(t){console.log("cdaddvadv")}),console.log("wait finished"),this.pid=t.pid,this.change=!1,this.req1_stat=!1,this.poost()}))},poost:function(){this.post(),this.req1_stat||this.$http.post("http://127.0.0.1:5000/post_zones",{pid:this.pid,zones:this.obs.cordinates}).then(function(t){console.log(t),console.log(this.obs),console.log("finished"),this.selections=[]})},updateobj:function(t){this.obs=t},batchUpdateSelections:function(t){this.selections=t},setPdfSize:function(t,e){this.pdfDimensions={width:t,height:e}},addSelection:function(t){0!==t.height&&0!==t.width&&this.selections.push({id:+new Date,coordinates:{top:t.top,left:t.left,height:t.height,width:t.width,page:t.page,pageOffset:t.pageOffset},color:u()({format:"rgb"}),name:"Box"+this.selections.length})},newFile:function(t){this.name===t?this.change=!1:this.change=!0,this.name=t.name,this.src=t.src,this.arrayBuffer=t.arrayBuffer,this.selections=[],this.obs=[],this.style=[]}}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(121),o=n.n(i),s=n(122);s.PDFViewer=o.a.PDFJS.PDFViewer,e.default={props:["arrayBuffer","setPdfSize"],data:function(){return{width:null}},computed:{styleObject:function(){return{width:this.width?this.width+"px":"auto"}}},watch:{arrayBuffer:function(){this.loadDocument()}},methods:{loadDocument:function(){var t=this;console.log("new document"),s.getDocument(this.arrayBuffer).then(function(e){e.getPage(1).then(function(n){var i=n.getViewport(1);t.setPdfSize(i.width,i.height),t.width=i.width,t.pdfViewer.setDocument(e).then(function(){window.scrollTo(0,0)})})})}},mounted:function(){var t=this,e=this.$refs["pdf-container"];this.pdfViewer=new s.PDFViewer({container:e}),e.addEventListener("pagesinit",function(){t.pdfViewer.currentScaleValue="page-width"}),this.loadDocument()}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={props:["selections","batchUpdateSelections","originalFilename","dimensions"],data:function(){return{c:0,pr:null,obs:[],uzn:null,editing:!1}},computed:{downloadable:function(){var t=new Blob([this.uzn],{type:"octet/stream"});return window.URL.createObjectURL(t)},filename:function(){return this.originalFilename.replace(/(.*)\..*/,"$1.uzn")}},mounted:function(){this.redrawUzn()},watch:{selections:function(){this.redrawUzn()}},methods:{startEditing:function(){this.editing=!0},stopEditing:function(){this.editing=!1,this.redrawUzn()},redrawUzn:function(){var t=this;if(!this.editing){if(0===this.selections.length)return this.uzn="",this.obs=[],void(this.c=0);var e=this.selections.map(function(e){var n=parseInt(t.dimensions.height-e.coordinates.top),i=parseInt(t.dimensions.height-e.coordinates.top-e.coordinates.height),o=e.coordinates.left;t.c!==t.selections.length&&(t.c++,t.obs.push({id:null,pageno:e.coordinates.page,cordinates:{zname:e.name,lx:e.coordinates.left,ly:Math.max(n,i),rx:e.coordinates.left+e.coordinates.width,ry:Math.min(n,i)}})),t.pr=o;var s=[e.coordinates.left,Math.max(n,i),e.coordinates.left+e.coordinates.width,Math.min(n,i)].join(","),r="LTPage[pageid=\\'"+e.coordinates.page+"\\'] LTTextLineHorizontal:overlaps_bbox(\""+s+'")';return"\t('"+e.name+"', '"+r+"')"});this.$emit("updateob",this.obs);var n=e.join(",\n");this.uzn="pdf = pdfquery.PDFQuery('"+this.originalFilename+"')\n\npdf.extract([\n\t('with_formatter', 'text'),\n"+n+"\n])",console.log(this.obs)}},changed:function(t){var e=this;console.log("CHANGED");var n=0,i=this.uzn.split("\n").map(function(t){var i=t.match(/\('(.*)',.*pageid=\\'(\d+)\\'.*bbox\("(\d+),(\d+),(\d+),(\d+)"\)/);try{var o=e.selections[n];return o.coordinates.left=parseInt(i[3]),o.coordinates.top=e.dimensions.height-parseInt(i[4]),o.coordinates.width=parseInt(i[5])-parseInt(i[3]),o.coordinates.height=Math.abs(parseInt(i[6])-parseInt(i[4])),o.name=i[1],o.page=i[2],n++,console.log(o),o}catch(t){return console.log(t),null}}).filter(function(t){return null!=t});this.batchUpdateSelections(i)}}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(68),o=n.n(i);e.default={props:["coordinates"],data:function(){return{text:null}},computed:{},watch:{coordinates:function(){this.highlightOverlaps()}},methods:{hasCoordinates:function(){var t=this.coordinates;return!!(t&&t.top&&t.left&&0!==t.height&&0!==t.width)},overlapping:function(){if(this.hasCoordinates()){var t=document.querySelectorAll('.page[data-page-number="1"] .textLayer div');return Array.prototype.filter.call(t,this._overlaps)}return[]},overlappingText:function(){return this.overlapping().map(function(t){return t.textContent}).join(" ")},highlightOverlaps:function(){this.unhighlight(),this.overlapping().forEach(this._highlight)},_highlight:function(t){-1===t.className.indexOf("selected-preview")&&(t.className+=" selected-preview")},unhighlight:function(t){var e=document.querySelectorAll(".selected-preview"),n=!0,i=!1,s=void 0;try{for(var r,a=o()(e);!(n=(r=a.next()).done);n=!0){var c=r.value;c.className=c.className.replace("selected-preview","")}}catch(t){i=!0,s=t}finally{try{!n&&a.return&&a.return()}finally{if(i)throw s}}},_overlaps:function(t){var e=this.coordinates;return!(t.offsetLeft>e.left+e.width||t.offsetLeft+t.offsetWidth<e.left)&&!(t.offsetTop>e.top+e.height||e.top>t.offsetTop+t.offsetHeight)},_sorted:function(t,e){return t.offsetTop===e.offsetTop?t.offsetLeft<e.offsetTop?-1:1:t.offsetTop<e.offsetTop?-1:1}}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={props:{notify:{type:Function,require:!0}},data:function(){return{name:null,pdf_file:null}},methods:{processReaderImage:function(t){this.notify({name:this.name,src:t.target.result})},processReaderPDF:function(t){this.notify({name:this.name,arrayBuffer:t.target.result})},getFile:function(t){var e=t[0];if(this.name=e.name,e.type.match("image.*")){var n=new FileReader;n.addEventListener("load",this.processReaderImage,!1),n.readAsDataURL(e),this.pdf_file=e}else if(e.type.match(".*pdf.*")){var i=new FileReader;i.addEventListener("load",this.processReaderPDF,!1),i.readAsArrayBuffer(e),this.pdf_file=e}else alert("Not a PDF or image file");this.$emit("addfile",this.pdf)},selected:function(t){this.getFile(t.target.files)},drop:function(t){t.stopPropagation(),t.preventDefault(),this.getFile(t.dataTransfer.files)},dragover:function(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy"}}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"zone-viewer",props:["selections","batchUpdateSelections","originalFilename"],data:function(){return{uzn:null,editing:!1}},computed:{downloadable:function(){var t=new Blob([this.uzn],{type:"octet/stream"});return window.URL.createObjectURL(t)},filename:function(){return this.originalFilename.replace(/(.*)\..*/,"$1.uzn")}},mounted:function(){this.redrawUzn()},watch:{selections:function(){this.redrawUzn()}},methods:{startEditing:function(){this.editing=!0},stopEditing:function(){this.editing=!1,this.redrawUzn()},redrawUzn:function(){if(!this.editing){var t=this.selections.map(function(t){return t.coordinates.left+" "+t.coordinates.top+" "+t.coordinates.width+" "+t.coordinates.height+" "+t.name});this.uzn=t.join("\n")}},changed:function(t){var e=this,n=this.uzn.split("\n").map(function(t,n){try{var i=t.match(/(\d+) (\d+) (\d+) (\d+) (.*)/),o=e.selections[n];return o.coordinates.left=parseInt(i[1]),o.coordinates.top=parseInt(i[2]),o.coordinates.width=parseInt(i[3]),o.coordinates.height=parseInt(i[4]),o.name=i[5],o}catch(t){return null}}).filter(function(t){return null!=t});console.log("updating with",n),this.batchUpdateSelections(n)}}}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,n){function i(t){n(105)}var o=n(3)(n(60),n(153),i,"data-v-5470518d",null);t.exports=o.exports},function(t,e,n){function i(t){n(101)}var o=n(3)(n(61),n(149),i,"data-v-10ce4bf0",null);t.exports=o.exports},function(t,e,n){function i(t){n(104)}var o=n(3)(n(62),n(152),i,null,null);t.exports=o.exports},function(t,e,n){function i(t){n(108)}var o=n(3)(n(63),n(156),i,null,null);t.exports=o.exports},function(t,e,n){function i(t){n(109)}var o=n(3)(n(64),n(157),i,"data-v-c71d66be",null);t.exports=o.exports},function(t,e,n){function i(t){n(107)}var o=n(3)(n(65),n(155),i,null,null);t.exports=o.exports},function(t,e,n){function i(t){n(106)}var o=n(3)(n(66),n(154),i,"data-v-7bb46fcd",null);t.exports=o.exports},function(t,e,n){function i(t){n(103)}var o=n(3)(n(67),n(151),i,null,null);t.exports=o.exports},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"selection-box",style:t.styleObject},[n("span",[t._v(t._s(t.name))])])},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("router-view")],1)},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.selections.length>0?n("div",{staticClass:"zone-viewer"},[n("h2",[t._v("Your zone file")]),t._v(" "),t._m(0),t._v(" "),n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.uzn,expression:"uzn"}],ref:"textarea",domProps:{value:t.uzn},on:{keyup:t.changed,blur:t.stopEditing,focus:t.startEditing,input:function(e){e.target.composing||(t.uzn=e.target.value)}}}),t._v(" "),n("a",{attrs:{href:t.downloadable,download:t.filename}},[t._v("Download .uzn file")])]):t._e()},staticRenderFns:[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("Edit the code below")]),t._v(" and it'll update on the right!")])}]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"editor"},[n("div",{staticClass:"sidebar"},[n("h1",[t._v("PDF - Annotator")]),t._v(" "),n("Uploader",{attrs:{notify:t.newFile},on:{addfile:t.addfile}}),t._v(" "),t.src?n("ZoneViewer",{staticClass:"zone-viewer",attrs:{selections:t.selections,batchUpdateSelections:t.batchUpdateSelections,originalFilename:t.name}}):t._e(),t._v(" "),t.arrayBuffer?n("PDFZoneViewer",{staticClass:"zone-viewer",attrs:{dimensions:t.pdfDimensions,selections:t.selections,batchUpdateSelections:t.batchUpdateSelections,originalFilename:t.name},on:{updateob:t.updateobj}}):t._e(),t._v(" "),n("button",{on:{click:t.poost}},[n("center",[t._v("submit")])],1)],1),t._v(" "),n("div",{staticClass:"content"},[n("Annotator",{attrs:{src:t.src,setPdfSize:t.setPdfSize,arrayBuffer:t.arrayBuffer,name:t.name,selections:t.selections,addSelection:t.addSelection}})],1)])},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[t.name?n("h3",[t._v("\n    Currently working on: "),n("span",{staticClass:"filename"},[t._v(t._s(t.name))]),t._v(" "),n("span",{staticClass:"filetype"},[t._v(t._s(t.arrayBuffer?"PDF":"image"))])]):t._e(),t._v(" "),t.src||t.arrayBuffer?n("div",{ref:"selectionArea",staticClass:"selection-area",on:{mousedown:t.start,mouseup:t.end,mousemove:t.drag}},[t.src?n("img",{attrs:{src:t.src}}):t._e(),t._v(" "),t.arrayBuffer?n("PDF",{attrs:{setPdfSize:t.setPdfSize,arrayBuffer:t.arrayBuffer}}):t._e(),t._v(" "),n("div",{staticClass:"area-select"},[t.arrayBuffer?n("SelectionPreview",{attrs:{coordinates:t.coordinates}}):t._e(),t._v(" "),n("AreaSelect",{ref:"activeSelector",attrs:{coordinates:t.coordinates,color:"rgb(0,255,0)",active:"true"}}),t._v(" "),t._l(t.selections,function(t){return n("AreaSelect",{key:t.id,attrs:{color:t.color,coordinates:t.coordinates,name:t.name}})})],2)],1):t._e()])},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{attrs:{id:"dragover"},on:{dragover:t.dragover,drop:t.drop}},[n("h3",[t._v("Drag & drop your file here")]),t._v(" "),t._m(0),t._v(" "),n("input",{attrs:{type:"file",id:"file",name:"file"},on:{change:t.selected}})])])},staticRenderFns:[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[t._v("or "),n("label",{attrs:{for:"file"}},[t._v("click to browse")])])}]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement;return(t._self._c||e)("div",{staticClass:"preview"},[t._v("\n"+t._s(t.text)+"\n")])},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"pdf-container",staticClass:"pdf-container",style:t.styleObject},[n("div",{staticClass:"pdfViewer"})])},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.selections.length>0?n("div",{staticClass:"pdf-zone-viewer"}):t._e()},staticRenderFns:[]}},,,,,function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){}]),[58]);
//# sourceMappingURL=app.e040bd315dfe4865d172.js.map